<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revolut Analytics - Transaction Insights</title>
    <link rel="stylesheet" href="../design_system/design-system.css">
    <link rel="stylesheet" href="../design_system/themes/dark.css">
    <link rel="stylesheet" href="analytics.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="../design_system/themes/theme-manager.js"></script>
</head>

<body>
    <header class="card-header">
        <h1>üí≥ Revolut Analytics Dashboard</h1>
        <nav class="page-nav">
            <a href="../index.html" class="nav-btn">üè† Home</a>
            <a href="../budget/index.html" class="nav-btn">ÔøΩ Budget Tool</a>
        </nav>
    </header>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="window.toggleTheme()" aria-label="Toggle theme">
        <span id="theme-icon">üåô</span>
    </button>

    <!-- Main Content -->
    <main>
        <!-- CSV File Upload with Exclusion Filters -->
        <div class="card-section">
            <div class="upload-header">
                <h2>Import Transaction Data</h2>
                <div class="exclusion-controls">
                    <button id="openExclusionModal" class="btn btn-secondary btn-sm">Configure filters</button>
                    <span class="tooltip">
                        <button class="btn btn-icon btn-sm" aria-label="Show default exclusions">‚ÑπÔ∏è</button>
                        <div class="tooltip-content top">
                            <strong>Default Exclusions:</strong><br>
                            ‚Ä¢ savings vault topup<br>
                            ‚Ä¢ to flexible cash funds<br>
                            ‚Ä¢ Topup<br>
                            ‚Ä¢ Transfer from<br>
                            ‚Ä¢ To pocket<br>
                            ‚Ä¢ Pocket Withdrawal<br>
                            ‚Ä¢ Exchanged to
                        </div>
                    </span>
                </div>
            </div>
            <div class="form-group">
                <label for="csvFile">Choose CSV File:</label>
                <input type="file" id="csvFile" accept=".csv" class="form-input">
            </div>
            <div id="exclusionStatus" class="exclusion-status-compact">
                <!-- Status will be shown here -->
            </div>
            <div class="upload-actions">
                <button id="loadSampleData" class="btn btn-secondary">Load Sample Data</button>
                <button id="clearData" class="btn btn-outline">Clear All Data</button>
            </div>
        </div>

        <!-- Analytics Overview Cards -->
        <div class="card-section">
            <h2>Overview</h2>
            <div class="analytics-overview">
                <div class="card card-summary card-summary-primary">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Total Transactions</div>
                        <div class="card-summary-value" id="totalTransactions">0</div>
                    </div>
                </div>
                <div class="card card-summary card-summary-danger">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Total Spent</div>
                        <div class="card-summary-value" id="totalSpent">0.00</div>
                    </div>
                </div>
                <div class="card card-summary card-summary-success">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Total Income</div>
                        <div class="card-summary-value" id="totalIncome">0.00</div>
                    </div>
                </div>
                <div class="card card-summary">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Current Balance</div>
                        <div class="card-summary-value" id="currentBalance">0.00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pie Charts Section -->
        <div class="card-section">
            <h2>Transaction Distribution</h2>
            <div class="charts-grid">
                <div class="card">
                    <div class="card-body">
                        <h3>By Type</h3>
                        <canvas id="typeChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <div class="card-body">
                        <h3>By Product</h3>
                        <canvas id="productChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Description Bar Chart Section -->
        <div class="card-section">
            <div class="description-chart-header">
                <h2>Transactions by Description</h2>
                <div class="description-filters">
                    <div class="form-group">
                        <label for="descriptionFilter">Filter by:</label>
                        <select id="descriptionFilter" class="form-input">
                            <option value="all">All Transactions</option>
                            <option value="expenses">Expenses Only</option>
                            <option value="income">Income Only</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="descriptionLimit">Show Top:</label>
                        <select id="descriptionLimit" class="form-input">
                            <option value="10">10 Items</option>
                            <option value="20">20 Items</option>
                            <option value="50">50 Items</option>
                            <option value="all">All Items</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="descriptionSort">Sort by:</label>
                        <select id="descriptionSort" class="form-input">
                            <option value="value">Transaction Value</option>
                            <option value="count">Transaction Count</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="card description-chart-container">
                <div class="card-body">
                    <canvas id="descriptionChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Advanced Analytics Section -->
        <div class="card-section">
            <h2>Card Payment Analysis</h2>
            <div class="analytics-filters">
                <div class="form-group">
                    <label for="dateRange">Date Range:</label>
                    <select id="dateRange" class="form-input">
                        <option value="all">All Time</option>
                        <option value="month">Last Month</option>
                        <option value="week">Last Week</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="amountRange">Amount Range:</label>
                    <select id="amountRange" class="form-input">
                        <option value="all">All Amounts</option>
                        <option value="small">Under $25</option>
                        <option value="medium">$25 - $100</option>
                        <option value="large">Over $100</option>
                    </select>
                </div>
            </div>

            <div class="spending-insights">
                <div class="card card-summary">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Average Transaction</div>
                        <div class="card-summary-value" id="avgTransaction">0.00</div>
                    </div>
                </div>
                <div class="card card-summary">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Most Frequent Category</div>
                        <div class="card-summary-value" id="topCategory">-</div>
                    </div>
                </div>
                <div class="card card-summary">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Largest Purchase</div>
                        <div class="card-summary-value" id="largestPurchase">0.00</div>
                    </div>
                </div>
                <div class="card card-summary card-summary-danger">
                    <div class="card-summary-content">
                        <div class="card-summary-label">Total Fees Paid</div>
                        <div class="card-summary-value" id="totalFees">0.00</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transaction Table Section -->
        <div class="card-section">
            <h2>All Transactions</h2>

            <!-- Table Controls -->
            <div class="table-controls">
                <div class="form-group">
                    <label for="searchInput">Search:</label>
                    <input type="text" id="searchInput" class="form-input" placeholder="Search transactions...">
                </div>

                <div class="filter-controls">
                    <div class="form-group">
                        <label for="typeFilter">Type:</label>
                        <select id="typeFilter" class="form-input">
                            <option value="">All Types</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="productFilter">Product:</label>
                        <select id="productFilter" class="form-input">
                            <option value="">All Products</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="stateFilter">State:</label>
                        <select id="stateFilter" class="form-input">
                            <option value="">All States</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Transaction Table -->
            <div class="table-container">
                <table id="transactionsTable" class="data-table">
                    <thead>
                        <tr>
                            <th data-sort="type">Type <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="product">Product <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="date">Date <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="description">Description <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="amount">Amount <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="fee">Fee <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="state">State <span class="sort-arrow">‚Üï</span></th>
                            <th data-sort="balance">Balance <span class="sort-arrow">‚Üï</span></th>
                        </tr>
                    </thead>
                    <tbody id="transactionsBody">
                        <!-- Transaction rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination" id="pagination">
                <!-- Pagination controls will be generated by JavaScript -->
            </div>
        </div>
    </main>
    </div>

    <!-- Exclusion Filters Modal -->
    <div id="exclusionModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Configure Exclusion Filters</h2>
                <button id="closeExclusionModal" class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <p>
                    Transactions containing these text patterns will be excluded from charts and tables.
                    Enter one pattern per line (case-insensitive matching).
                </p>
                <div class="form-group">
                    <label for="exclusionList">Excluded Text Patterns:</label>
                    <textarea id="exclusionList" class="form-input" rows="6"
                        placeholder="Enter text patterns to exclude...&#10;Example:&#10;savings vault topup&#10;Transfer from&#10;Topup"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button id="clearExclusions" class="modal-btn">Clear All</button>
                <button id="resetExclusions" class="modal-btn secondary">Reset to Defaults</button>
                <button id="applyExclusions" class="modal-btn primary">Apply Filters</button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="spinner-overlay">
        <div class="spinner"></div>
    </div>

    <script src="analytics.js"></script>
</body>

</html>
