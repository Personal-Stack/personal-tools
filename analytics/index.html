<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Analytics - Budget Planner</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="stylesheet" href="./analytics.css">
     <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;700&amp;display=swap"
      rel="stylesheet"
    />
    <!-- Chart.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- ag-Grid library -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ag-grid-community/styles@34.2.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ag-grid-community/styles@34.2.0/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@ag-grid-community/styles@34.2.0/ag-theme-quartz.css">
    <script src="https://unpkg.com/ag-grid-community/dist/ag-grid-community.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìä CSV Analytics</h1>
            <nav class="page-nav">
                <a href="../index.html" class="nav-btn">üè† Budget Planner</a>
            </nav>
        </header>

        <main>
            <!-- CSV Upload Section -->
            <section class="csv-upload full-width">
                <h2>Upload CSV Data</h2>
                <p>Upload a CSV file with transaction data to analyze spending patterns and balances.</p>
                
                <div class="upload-area">
                    <div class="upload-group">
                        <label for="csvFile">Select CSV file:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="csvFile" accept=".csv,text/csv" style="display: none;">
                            <span class="file-input-text" onclick="document.getElementById('csvFile').click()">Choose CSV file</span>
                        </div>
                        <div id="uploadStatus" class="upload-status"></div>
                    </div>
                    
                    <div class="csv-format-info">
                        <h3>Expected CSV Format:</h3>
                        <div class="format-example">
                            <code>Type,Product,Started Date,Completed Date,Description,Amount,Fee,Currency,State,Balance</code>
                        </div>
                        <p><strong>Example row:</strong></p>
                        <div class="format-example">
                            <code>Payment,Credit Card,2024-01-15,2024-01-15,Grocery Shopping,-45.50,0.00,USD,Completed,1250.75</code>
                        </div>
                        <p><a href="sample-transactions.csv" download class="sample-link">üì• Download Sample CSV</a></p>
                    </div>
                </div>
            </section>

            <!-- Data Summary Section -->
            <section class="data-summary full-width" id="dataSummary" style="display: none;">
                <h2>üìã Data Summary</h2>
                <div class="summary-grid">
                    <div class="summary-card">
                        <div class="summary-label">Total Transactions</div>
                        <div class="summary-value" id="totalTransactions">0</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Total Amount</div>
                        <div class="summary-value" id="totalAmount">$0.00</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Average Balance</div>
                        <div class="summary-value" id="averageBalance">$0.00</div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-label">Date Range</div>
                        <div class="summary-value" id="dateRange">-</div>
                    </div>
                </div>
            </section>

            <!-- Advanced Filters Section -->
            <section class="advanced-filters full-width" id="filtersSection" style="display: none;">
                <div class="section-header">
                    <h2>üîç Advanced Analytics Filters</h2>
                    <button type="button" class="reset-filters-btn" onclick="csvAnalytics.resetFilters()">‚Ü∫ Reset Filters</button>
                </div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label for="typeFilter">Transaction Type:</label>
                        <select id="typeFilter" onchange="csvAnalytics.applyFilters()">
                            <option value="">All Types</option>
                            <option value="Card Payment">Card Payment</option>
                            <option value="Transfer">Transfer</option>
                            <option value="Exchange">Exchange</option>
                            <option value="Topup">Topup</option>
                            <option value="ATM">ATM</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="productFilter">Product Type:</label>
                        <select id="productFilter" onchange="csvAnalytics.applyFilters()">
                            <option value="">All Products</option>
                            <option value="Current">Current</option>
                            <option value="Savings">Savings</option>
                            <option value="Deposit">Deposit</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="dateFromFilter">Date From:</label>
                        <input type="date" id="dateFromFilter" onchange="csvAnalytics.applyFilters()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="dateToFilter">Date To:</label>
                        <input type="date" id="dateToFilter" onchange="csvAnalytics.applyFilters()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="minAmountFilter">Min Amount:</label>
                        <input type="number" id="minAmountFilter" placeholder="0.00" step="0.01" onchange="csvAnalytics.applyFilters()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="maxAmountFilter">Max Amount:</label>
                        <input type="number" id="maxAmountFilter" placeholder="1000.00" step="0.01" onchange="csvAnalytics.applyFilters()">
                    </div>
                    
                    <div class="filter-group">
                        <label for="descriptionFilter">Description Contains:</label>
                        <input type="text" id="descriptionFilter" placeholder="Search descriptions..." onchange="csvAnalytics.applyFilters()">
                    </div>
                </div>
                
                <!-- Analytics Insights Panel -->
                <div class="insights-panel">
                    <h3>üìä Spending Insights</h3>
                    <div id="insightsContent" class="insights-content">
                        <!-- Dynamic insights will be populated here -->
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="analytics-charts full-width" id="chartsSection" style="display: none;">
                <div class="section-header">
                    <h2>üìà Analytics Charts</h2>
                    <button type="button" class="refresh-btn" onclick="csvAnalytics.refreshCharts()">üîÑ Refresh Charts</button>
                </div>
                
                <div class="charts-grid">
                    <!-- Description Chart -->
                    <div class="chart-container">
                        <div class="chart-row">
                            <div class="chart-display">
                                <h3>Spending by Description</h3>
                                <canvas id="descriptionChart"></canvas>
                            </div>
                            <div class="chart-items-list">
                                <h4>Description Breakdown:</h4>
                                <div class="items-list-content" id="descriptionItems">
                                    <!-- Items will be populated here -->
                                </div>
                                <div class="chart-total">
                                    <span class="chart-total-label">Total:</span>
                                    <span class="chart-total-value" id="descriptionTotal">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- State Chart -->
                    <div class="chart-container">
                        <div class="chart-row">
                            <div class="chart-display">
                                <h3>Transactions by State</h3>
                                <canvas id="stateChart"></canvas>
                            </div>
                            <div class="chart-items-list">
                                <h4>State Breakdown:</h4>
                                <div class="items-list-content" id="stateItems">
                                    <!-- Items will be populated here -->
                                </div>
                                <div class="chart-total">
                                    <span class="chart-total-label">Total:</span>
                                    <span class="chart-total-value" id="stateTotal">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Transaction Type Chart -->
                    <div class="chart-container">
                        <div class="chart-row">
                            <div class="chart-display">
                                <h3>Transactions by Type</h3>
                                <canvas id="typeChart"></canvas>
                            </div>
                            <div class="chart-items-list">
                                <h4>Type Breakdown:</h4>
                                <div class="items-list-content" id="typeItems">
                                    <!-- Items will be populated here -->
                                </div>
                                <div class="chart-total">
                                    <span class="chart-total-label">Total:</span>
                                    <span class="chart-total-value" id="typeTotal">$0.00</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Spending Trends Chart -->
                    <div class="chart-container full-width">
                        <h3>üìà Spending Trends & Patterns</h3>
                        <div class="chart-controls">
                            <select id="trendsTimeframe" onchange="csvAnalytics.updateTrendsChart()">
                                <option value="daily">Daily Trends</option>
                                <option value="weekly">Weekly Trends</option>
                                <option value="monthly" selected>Monthly Trends</option>
                            </select>
                            <select id="trendsMetric" onchange="csvAnalytics.updateTrendsChart()">
                                <option value="amount">Total Amount</option>
                                <option value="count">Transaction Count</option>
                                <option value="average">Average per Transaction</option>
                            </select>
                        </div>
                        <div class="chart-display-full">
                            <canvas id="trendsChart"></canvas>
                        </div>
                    </div>

                    <!-- Balance Trend Chart -->
                    <div class="chart-container full-width">
                        <h3>Balance Over Time</h3>
                        <div class="chart-display-full">
                            <canvas id="balanceChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Data Grid Section -->
            <section class="data-grid full-width" id="dataGrid" style="display: none;">
                <div class="section-header">
                    <h2>üìä Transaction Data Grid</h2>
                    <div class="grid-controls">
                        <input type="text" id="quickFilterInput" placeholder="Quick filter transactions..." onkeyup="csvAnalytics.updateQuickFilter()">
                        <button type="button" class="export-btn" onclick="csvAnalytics.exportGridData()">üì§ Export Data</button>
                        <button type="button" class="reset-btn" onclick="csvAnalytics.resetGridFilters()">ÔøΩ Reset Filters</button>
                    </div>
                </div>
                <div id="transactionsGrid" class="ag-theme-quartz grid-container">
                    <!-- ag-Grid will be rendered here -->
                </div>
            </section>
        </main>
    </div>

    <script src="./analytics.js"></script>
</body>
</html>