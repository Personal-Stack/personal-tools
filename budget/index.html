<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Planner - Comprehensive Budget Tracking with Multi-Currency Support</title>
    <meta name="description" content="A comprehensive budget tracking application with multi-currency support, investment allocation, dynamic charts, and change history tracking. Plan your finances with real-time calculations and visual analytics.">
    <meta name="keywords" content="budget tracker, budget planner, personal finance, multi-currency, investment tracking, expense management, financial planning">
    <meta name="author" content="Budget Planner">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Budget Planner - Comprehensive Budget Tracking">
    <meta property="og:description" content="Track your budget with multi-currency support, investment allocation, and dynamic charts. Complete with change history and data import/export.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://bbogdanov.github.io/simple-budget/">
    <meta property="og:image" content="https://bbogdanov.github.io/simple-budget/preview.png">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Budget Planner - Comprehensive Budget Tracking">
    <meta name="twitter:description" content="Track your budget with multi-currency support, investment allocation, and dynamic charts.">
    <meta name="twitter:image" content="https://bbogdanov.github.io/simple-budget/preview.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üí∞</text></svg>">
    
    <!-- Design System Imports -->
    <link rel="stylesheet" href="../design_system/design-system.css">
    <link rel="stylesheet" href="../design_system/themes/dark.css">
    <link rel="stylesheet" href="budget-compatibility.css">
    
    <!-- Chart.js library - can be replaced with local file -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="../design_system/themes/theme-manager.js"></script>
</head>
<body>
    <!-- Theme Toggle Button -->
    <button class="theme-toggle" onclick="window.toggleTheme()" aria-label="Toggle theme">
        <span id="theme-icon">üåô</span>
    </button>
    
    <!-- Utility Buttons -->
    <div class="utility-buttons">
        <button type="button" class="utility-btn export-btn" onclick="budgetTracker.exportCompleteData()" title="Export complete budget data with history as JSON" aria-label="Export data">
            <span>üì• </span>
        </button>
        <button type="button" class="utility-btn help-btn" onclick="budgetTracker.showHelpPopup()" title="Show usage hints and tips" aria-label="Help & Tips">
            <span>‚ùì</span>
        </button>
    </div>

    <div class="container">
        <header class="card-header">
            <h1>üí∞ Budget Planner</h1>
            
            <nav class="page-nav">
                <a href="../index.html" class="nav-btn">üè† Home</a>
                <a href="../revolut-analytics/index.html" class="nav-btn">üìä Analytics</a>
            </nav>
        </header>

        <main>
            <!-- Annual Budget Section -->
            <div class="card-section">
                <h2>Annual Budget Setup</h2>
                
                <div class="budget-setup-grid">
                    <div class="form-group">
                        <label for="currency">Currency:</label>
                        <select id="currency" class="form-input">
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (‚Ç¨)</option>
                            <option value="BGN">BGN (–ª–≤)</option>
                            <option value="GBP">GBP (¬£)</option>
                            <option value="JPY">JPY (¬•)</option>
                            <option value="CAD">CAD (C$)</option>
                            <option value="AUD">AUD (A$)</option>
                            <option value="CHF">CHF (Fr)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="maxCash">Max Available Cash Per Year (<span id="currencySymbol">$</span>):</label>
                        <input type="number" id="maxCash" class="form-input" placeholder="Enter your annual budget" min="0" step="0.01">
                    </div>
                </div>
                
                <div class="investment-form-compact">
                    <div class="investment-header-compact">
                        <h3>üíπ Investment Allocation</h3>
                    </div>
                    
                    <div class="investment-inline-form">
                        <div class="investment-form-row">
                            <div class="form-field-compact">
                                <label for="investmentType" class="form-label-compact">Type:</label>
                                <select id="investmentType" class="form-input form-input-compact">
                                    <option value="amount">Amount ($)</option>
                                    <option value="percentage">Percent (%)</option>
                                </select>
                            </div>
                            
                            <div class="form-field-compact">
                                <label for="investmentValue" class="form-label-compact">Value:</label>
                                <div class="input-group-compact">
                                    <input type="number" id="investmentValue" class="form-input form-input-compact" placeholder="0.00" min="0" step="0.01">
                                    <span class="input-group-text-compact" id="investmentUnit">$</span>
                                </div>
                            </div>
                            
                            <div class="form-field-compact">
                                <label for="investmentFrequency" class="form-label-compact">Frequency:</label>
                                <select id="investmentFrequency" class="form-input form-input-compact">
                                    <option value="monthly" selected>Monthly</option>
                                    <option value="quarterly">Quarterly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="import-section">
                    <h3>Import Budget Data</h3>
                    <p>Select a feed.json file to instantly import and populate your budget items and settings.</p>
                    
                    <div class="form-group">
                        <label for="feedFile">Select feed.json file:</label>
                        <div class="file-input-wrapper">
                            <input type="file" id="feedFile" class="form-input" accept="application/json,.json" onchange="budgetTracker.handleFeedImport()">
                        </div>
                        <span id="importStatus" class="import-status"></span>
                    </div>
                    

                    
                    <details class="json-format-help">
                        <summary>Expected JSON Format</summary>
                        <pre><code>{
  "settings": {
    "maxCash": 100000,
    "currency": "USD",
    "investment": {
      "type": "percentage",
      "value": 10,
      "frequency": "yearly"
    }
  },
  "items": [
    {
      "name": "rent",
      "value": 1200,
      "frequency": "monthly",
      "tags": ["housing", "essential"]
    }
  ],
  "changeHistory": [
    {
      "timestamp": "2024-01-15T10:30:00.000Z",
      "action": "item_added",
      "details": { "itemName": "rent", "value": 1200 },
      "comment": "Added monthly rent expense",
      "currency": "USD"
    }
  ]
}</code></pre>
                    </details>
                </div>
            </div>

            <!-- Budget Summary Section -->
            <div class="card-section">
                <h2>üí∞ Budget Summary</h2>
                
                <div class="analytics-overview">
                    <div class="card card-summary card-summary-primary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">üìÖ Total Monthly Expenses</div>
                            <div class="card-summary-value" id="totalMonthly">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary card-summary-danger">
                        <div class="card-summary-content">
                            <div class="card-summary-label">üìä Total Expenses</div>
                            <div class="card-summary-value" id="totalAnnual">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary card-summary-success">
                        <div class="card-summary-content">
                            <div class="card-summary-label">üíπ Investment</div>
                            <div class="card-summary-value" id="totalInvestment">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">ÔøΩ Remaining Budget</div>
                            <div class="card-summary-value" id="remainingBudget">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">üéØ Status</div>
                            <div class="card-summary-value" id="budgetStatus">-</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Budget Indicators Section -->
            <div class="card-section">
                <h2>Budget Indicators</h2>
                
                <div class="analytics-overview">
                    <div class="card card-summary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">Daily</div>
                            <div class="card-summary-value" id="dailyMax">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">Weekly</div>
                            <div class="card-summary-value" id="weeklyMax">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">Monthly</div>
                            <div class="card-summary-value" id="monthlyMax">$0.00</div>
                        </div>
                    </div>
                    
                    <div class="card card-summary">
                        <div class="card-summary-content">
                            <div class="card-summary-label">Yearly</div>
                            <div class="card-summary-value" id="yearlyMax">$0.00</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="card-section">
                <div class="section-header">
                    <h2>Budget Visualization</h2>
                    <button type="button" id="refreshChartsBtn" class="btn btn-secondary" onclick="budgetTracker.updateCharts()">üîÑ Refresh Charts</button>
                </div>
                
                <div class="charts-grid">
                    <div class="card">
                        <div class="card-body">
                            <canvas id="budgetChart"></canvas>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-body">
                            <canvas id="remainingChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dynamic Charts Section -->
            <div class="card-section">
                <div class="section-header">
                    <h2>Custom Charts</h2>
                </div>
                
                <p>Create custom pie charts to analyze your budget by specific tags, frequencies, or combinations.</p>
                
                
                <div class="chart-controls-compact">
                    <div class="chart-controls-header">
                        <h3>Add New Chart</h3>
                        <button type="button" id="refreshDynamicChartsBtn" class="btn btn-secondary btn-sm" onclick="budgetTracker.refreshDynamicCharts()">üîÑ Refresh</button>
                    </div>
                    
                    <div class="chart-form-inline">
                        <div class="form-row">
                            <div class="form-col">
                                <label for="chartType" class="form-label-compact">Type:</label>
                                <select id="chartType" class="form-input form-input-compact">
                                    <option value="tag">By Tag</option>
                                    <option value="frequency">By Frequency</option>
                                    <option value="combined">Tag + Frequency</option>
                                </select>
                            </div>
                            
                            <div class="form-col" id="tagFilterGroup">
                                <label for="tagChartSelect" class="form-label-compact">Tag:</label>
                                <select id="tagChartSelect" class="form-input form-input-compact">
                                    <option value="" disabled selected>Choose tag</option>
                                    <option value="__all__">All Items</option>
                                </select>
                            </div>
                            
                            <div class="form-col" id="freqFilterGroup" style="display: none;">
                                <label for="freqChartSelect" class="form-label-compact">Frequency:</label>
                                <select id="freqChartSelect" class="form-input form-input-compact">
                                    <option value="" disabled selected>Choose frequency</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                            </div>
                            
                            <div class="form-col-group" id="combinedFilterGroup" style="display: none;">
                                <div class="form-col">
                                    <label for="combinedTagSelect" class="form-label-compact">Tag:</label>
                                    <select id="combinedTagSelect" class="form-input form-input-compact">
                                        <option value="" disabled selected>Choose tag</option>
                                        <option value="__all__">All Tags</option>
                                    </select>
                                </div>
                                <div class="form-col">
                                    <label for="combinedFreqSelect" class="form-label-compact">Freq:</label>
                                    <select id="combinedFreqSelect" class="form-input form-input-compact">
                                        <option value="" disabled selected>Choose frequency</option>
                                        <option value="__all__">All Frequencies</option>
                                        <option value="daily">Daily</option>
                                        <option value="weekly">Weekly</option>
                                        <option value="monthly">Monthly</option>
                                        <option value="yearly">Yearly</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" id="addCustomChartBtn" class="btn btn-primary btn-sm">+ Add</button>
                                <button type="button" id="clearAllChartsBtn" class="btn btn-outline btn-sm">Clear All</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <div id="dynamicCharts" class="dynamic-charts-container">
                    <!-- Dynamic charts will be added here -->
                </div>
                
                <div class="no-charts-message" id="noChartsMessage">
                    <p>No custom charts created yet. Use the controls above to create your first chart!</p>
                </div>
            </div>

            <!-- Change History Section -->
            <div class="card-section">
                <div class="section-header">
                    <h2>Change History</h2>
                    <button type="button" id="toggleHistoryBtn" class="btn btn-secondary" onclick="budgetTracker.toggleHistory()">üìã Show/Hide History</button>
                </div>
                
                <div id="historyContainer" class="history-container" style="display: none;">
                    <div class="history-filters">
                        <div class="form-group">
                            <label for="historyActionFilter">Filter by Action:</label>
                            <select id="historyActionFilter" class="form-input" onchange="budgetTracker.filterHistory()">
                                <option value="">All Actions</option>
                                <option value="item_added">Items Added</option>
                                <option value="item_removed">Items Removed</option>
                                <option value="item_edited">Items Edited</option>
                                <option value="max_cash_updated">Budget Changes</option>
                                <option value="currency_changed">Currency Changes</option>
                                <option value="investment_value_changed">Investment Changes</option>
                                <option value="feed_imported">Feed Imports</option>
                            </select>
                        </div>
                        
                        <div class="history-actions">
                            <button type="button" class="btn btn-secondary" onclick="budgetTracker.exportHistory()">Export History</button>
                            <button type="button" class="btn btn-secondary" onclick="budgetTracker.importHistory()">Import History</button>
                            <button type="button" class="btn btn-outline" onclick="budgetTracker.clearHistory()">Clear History</button>
                        </div>
                    </div>
                    <div class="history-list" id="historyList">
                        <!-- History entries will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- Budget Items Section -->
            <div class="card-section">
                <div class="section-header">
                    <h2>Budget Items</h2>
                </div>
                
                <div class="add-item-form-compact">
                    <div class="form-header-compact">
                        <h3>Add New Item</h3>
                    </div>
                    
                    <div class="form-inline-compact">
                        <div class="form-row-compact">
                            <div class="form-field-group">
                                <label for="itemName" class="form-label-compact">Name:</label>
                                <input type="text" id="itemName" class="form-input form-input-compact" placeholder="Item name" required>
                            </div>
                            
                            <div class="form-field-group">
                                <label for="itemValue" class="form-label-compact">Amount:</label>
                                <input type="number" id="itemValue" class="form-input form-input-compact" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                            
                            <div class="form-field-group">
                                <label for="itemFrequency" class="form-label-compact">Frequency:</label>
                                <select id="itemFrequency" class="form-input form-input-compact">
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="monthly" selected>Monthly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                            </div>
                            
                            <div class="form-field-group">
                                <label for="itemTags" class="form-label-compact">Tags:</label>
                                <input type="text" id="itemTags" class="form-input form-input-compact" placeholder="Optional tags">
                            </div>
                            
                            <div class="form-actions-compact">
                                <button id="addItemBtn" class="btn btn-primary btn-sm" onclick="addItem()">+ Add Item</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="items-list" id="itemsList">
                    <!-- Items will be added here dynamically -->
                </div>
            </div>
        </main>
    </div>

    <!-- Help Popup Modal -->
    <div id="helpModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí° Budget Planner - Help & Tips</h2>
                <button type="button" class="modal-close" onclick="budgetTracker.closeHelpPopup()">&times;</button>
            </div>
                <div class="modal-body">
                    <div class="help-section">
                        <h3>üöÄ Getting Started</h3>
                        <ul>
                            <li><strong>Set Your Annual Budget:</strong> Enter your total available cash per year</li>
                            <li><strong>Choose Currency:</strong> Select your preferred currency (converts existing data automatically)</li>
                            <li><strong>Investment Allocation:</strong> Set aside money for investments (percentage or fixed amount)</li>
                            <li><strong>Add Budget Items:</strong> Create entries for rent, groceries, utilities, etc. with frequencies</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>üìä Using Budget Features</h3>
                        <ul>
                            <li><strong>Tags:</strong> Organize items with tags like "essential", "housing", "entertainment"</li>
                            <li><strong>Frequencies:</strong> Set items as daily, weekly, monthly, or yearly</li>
                            <li><strong>Custom Charts:</strong> Create visual breakdowns by tags or frequencies</li>
                            <li><strong>Budget Indicators:</strong> See your remaining budget per day/week/month/year</li>
                            <li><strong>Change History:</strong> Track all modifications with timestamps and comments</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>üíæ Data Management & Privacy</h3>
                        <div class="privacy-notice">
                            <p><strong>üîí Your Data Stays Yours:</strong> All budget data is stored locally in your browser. Nothing is sent to external servers.</p>
                        </div>
                        <ul>
                            <li><strong>Export Complete Data:</strong> Click "üì• Export Complete Data" to download everything (settings + items + history)</li>
                            <li><strong>Import Data:</strong> Use "Import Budget Data" to restore from a JSON file</li>
                            <li><strong>Backup Regularly:</strong> Export your data periodically to avoid loss</li>
                            <li><strong>Cross-Device Sync:</strong> Export from one device, import on another</li>
                            <li><strong>Version Control:</strong> Keep dated exports to track your budget evolution</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>üìà Analytics Features</h3>
                        <ul>
                            <li><strong>CSV Analytics:</strong> Upload bank transaction files for spending analysis</li>
                            <li><strong>Visual Charts:</strong> See spending patterns by description, type, and trends</li>
                            <li><strong>Advanced Filters:</strong> Filter transactions by date, amount, type, and description</li>
                            <li><strong>Data Grid:</strong> Professional table view with sorting and filtering</li>
                            <li><strong>Export Filtered:</strong> Download filtered transaction data</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>üí° Pro Tips</h3>
                        <ul>
                            <li><strong>Start Simple:</strong> Begin with major expenses (rent, groceries, utilities)</li>
                            <li><strong>Use Meaningful Tags:</strong> Group similar expenses for better insights</li>
                            <li><strong>Review Regularly:</strong> Check your budget monthly and adjust as needed</li>
                            <li><strong>Emergency Fund:</strong> Keep some budget unallocated for unexpected expenses</li>
                            <li><strong>Export Before Changes:</strong> Back up data before major modifications</li>
                            <li><strong>Combine with Analytics:</strong> Use CSV analytics to validate your budget assumptions</li>
                        </ul>
                    </div>

                    <div class="help-section">
                        <h3>üîß Troubleshooting</h3>
                        <ul>
                            <li><strong>Data Missing?</strong> Check browser storage or import your latest export</li>
                            <li><strong>Import Errors?</strong> Ensure JSON file matches the expected format</li>
                            <li><strong>Charts Not Showing?</strong> Refresh the page or add some budget items</li>
                            <li><strong>Currency Issues?</strong> Currency changes convert all existing values automatically</li>
                        </ul>
                    </div>
                </div>
            <div class="modal-footer">
                <button type="button" class="modal-btn primary" onclick="budgetTracker.closeHelpPopup()">Got it!</button>
                <button type="button" class="modal-btn secondary" onclick="budgetTracker.exportCompleteData()">üì• Export My Data Now</button>
            </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
    
    <!-- Initialize Theme Manager -->
    <script>
        // Initialize theme manager
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof ThemeManager !== 'undefined') {
                window.themeManager = new ThemeManager();
                console.log('Theme Manager initialized');
                
                // Update theme icon based on current theme
                function updateThemeIcon() {
                    const currentTheme = window.themeManager.getCurrentTheme();
                    const themeIcon = document.getElementById('theme-icon');
                    if (themeIcon) {
                        themeIcon.textContent = currentTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                    }
                }
                
                // Set up theme toggle function
                window.toggleTheme = function() {
                    const currentTheme = window.themeManager.getCurrentTheme();
                    const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                    window.themeManager.setTheme(newTheme);
                    updateThemeIcon();
                };
                
                // Update icon on load
                updateThemeIcon();
            } else {
                console.error('ThemeManager not found');
            }
        });
    </script>
</body>
</html>